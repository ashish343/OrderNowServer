/**
 * @fileOverview Favico animations
 * @author Miroslav Magda, http://blog.ejci.net
 * @version 0.2.0
 */
var Favico=function(u){function y(a){if(a.paused||a.ended||t)return!1;try{b.clearRect(0,0,d,f),b.drawImage(a,0,0,d,f)}catch(r){}setTimeout(y,g.duration,a);v.setIcon(p)}function B(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return b+b+c+c+d+d});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:!1}function C(a,b){var c={},e;for(e in a)c[e]=a[e];for(e in b)c[e]=b[e];return c}u=u?u:{};var z={bgColor:"#d00",
textColor:"#fff",type:"circle",animation:"slide",elementId:!1},c,k,f,d,p,b,l,s,w,A,m,t,h,n=[];m=function(){};s=t=!1;var q={ready:function(){s=!0;q.reset();m()},reset:function(){n=[];w=!1;b.clearRect(0,0,d,f);b.drawImage(l,0,0,d,f);v.setIcon(p)},start:function(){if(s&&!A){var a=function(){w=n[0];A=!1;0<n.length&&(n.shift(),q.start())};0<n.length&&(A=!0,w?g.run(w.options,function(){g.run(n[0].options,function(){a()},!1)},!0):g.run(n[0].options,function(){a()},!1))}}},x={},D=function(a){a.n=Math.abs(a.n);
a.x*=d;a.y*=f;a.w*=d;a.h*=f;return a};x.circle=function(a){a=D(a);var r=9<a.n;r&&(a.x-=0.4*a.w,a.w*=1.4);b.clearRect(0,0,d,f);b.drawImage(l,0,0,d,f);b.beginPath();b.font="bold "+Math.floor(a.h)+"px sans-serif";b.textAlign="center";r?(b.moveTo(a.x+a.w/2,a.y),b.lineTo(a.x+a.w-a.h/2,a.y),b.quadraticCurveTo(a.x+a.w,a.y,a.x+a.w,a.y+a.h/2),b.lineTo(a.x+a.w,a.y+a.h-a.h/2),b.quadraticCurveTo(a.x+a.w,a.y+a.h,a.x+a.w-a.h/2,a.y+a.h),b.lineTo(a.x+a.h/2,a.y+a.h),b.quadraticCurveTo(a.x,a.y+a.h,a.x,a.y+a.h-a.h/
2),b.lineTo(a.x,a.y+a.h/2),b.quadraticCurveTo(a.x,a.y,a.x+a.h/2,a.y)):b.arc(a.x+a.w/2,a.y+a.h/2,a.h/2,0,2*Math.PI);b.fillStyle="rgba("+c.bgColor.r+","+c.bgColor.g+","+c.bgColor.b+","+a.o+")";b.fill();b.closePath();b.beginPath();b.stroke();b.fillStyle="rgba("+c.textColor.r+","+c.textColor.g+","+c.textColor.b+","+a.o+")";b.fillText(r?"9+":a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-0.15*a.h));b.closePath()};x.rectangle=function(a){a=D(a);var r=9<a.n;r&&(a.x=Math.floor(a.x-0.4*a.w),a.w=Math.floor(1.4*
a.w));b.clearRect(0,0,d,f);b.drawImage(l,0,0,d,f);b.beginPath();b.font="bold "+Math.floor(a.h)+"px sans-serif";b.textAlign="center";b.fillStyle="rgba("+c.bgColor.r+","+c.bgColor.g+","+c.bgColor.b+","+a.o+")";b.fillRect(a.x,a.y,a.w,a.h);b.fillStyle="rgba("+c.textColor.r+","+c.textColor.g+","+c.textColor.b+","+a.o+")";b.fillText(r?"9+":a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-0.15*a.h));b.closePath()};var v={getIcon:function(){var a=!1;if(c.elementId)a=document.getElementById(c.elementId),a.setAttribute("href",
a.getAttribute("src"));else{a:{for(var a=document.getElementsByTagName("head")[0].getElementsByTagName("link"),b=a.length-1;0<=b;b--)if(/icon/i.test(a[b].getAttribute("rel"))){a=a[b];break a}a=!1}!1===a&&(a=document.createElement("link"),a.setAttribute("rel","icon"),document.getElementsByTagName("head")[0].appendChild(a))}a.setAttribute("type","imapge/png");return a},setIcon:function(a){a=a.toDataURL("image/png");if(c.elementId)document.getElementById(c.elementId).setAttribute("src",a);else if(h.ff||
h.opera){k.getAttribute("rel");var b=k;k=document.createElement("link");h.opera&&k.setAttribute("rel","icon");k.setAttribute("rel","icon");k.setAttribute("type","image/png");document.getElementsByTagName("head")[0].appendChild(k);k.setAttribute("href",a);b.parentNode&&b.parentNode.removeChild(b)}else k.setAttribute("href",a)}},g={duration:40,types:{}};g.types.fade=[{x:0.4,y:0.4,w:0.6,h:0.6,o:0},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.1},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.2},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.3},{x:0.4,
y:0.4,w:0.6,h:0.6,o:0.4},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.5},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.6},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.7},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.8},{x:0.4,y:0.4,w:0.6,h:0.6,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];g.types.none=[{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];g.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:0.9,y:0.9,w:0.1,h:0.1,o:1},{x:0.8,y:0.8,w:0.2,h:0.2,o:1},{x:0.7,y:0.7,w:0.3,h:0.3,o:1},{x:0.6,y:0.6,w:0.4,h:0.4,o:1},{x:0.5,y:0.5,w:0.5,h:0.5,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];g.types.popFade=[{x:0.75,
y:0.75,w:0,h:0,o:0},{x:0.65,y:0.65,w:0.1,h:0.1,o:0.2},{x:0.6,y:0.6,w:0.2,h:0.2,o:0.4},{x:0.55,y:0.55,w:0.3,h:0.3,o:0.6},{x:0.5,y:0.5,w:0.4,h:0.4,o:0.8},{x:0.45,y:0.45,w:0.5,h:0.5,o:0.9},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];g.types.slide=[{x:0.4,y:1,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.9,w:0.6,h:0.6,o:1},{x:0.4,y:0.8,w:0.6,h:0.6,o:1},{x:0.4,y:0.7,w:0.6,h:0.6,o:1},{x:0.4,y:0.6,w:0.6,h:0.6,o:1},{x:0.4,y:0.5,w:0.6,h:0.6,o:1},{x:0.4,y:0.4,w:0.6,h:0.6,o:1}];g.run=function(a,b,d,e){var f=
g.types[c.animation];e=!0===d?"undefined"!==typeof e?e:f.length-1:"undefined"!==typeof e?e:0;b=b?b:function(){};e<f.length&&0<=e?(x[c.type](C(a,f[e])),setTimeout(function(){e=d?e-1:e+1;g.run(a,b,d,e)},g.duration),v.setIcon(p)):b()};(function(){c=C(z,u);c.bgColor=B(c.bgColor);c.textColor=B(c.textColor);c.animation=g.types[""+c.animation]?c.animation:z.animation;c.type=x[""+c.type]?c.type:z.type;try{k=v.getIcon(),p=document.createElement("canvas"),l=document.createElement("img"),l.setAttribute("src",
k.getAttribute("href")),l.onload=function(){f=0<l.height?l.height:32;d=0<l.width?l.width:32;p.height=f;p.width=d;b=p.getContext("2d");q.ready()},h={},h.ff=/firefox/i.test(navigator.userAgent.toLowerCase()),h.chrome=/chrome/i.test(navigator.userAgent.toLowerCase()),h.opera=/opera/i.test(navigator.userAgent.toLowerCase()),h.ie=/msie/i.test(navigator.userAgent.toLowerCase())||/trident/i.test(navigator.userAgent.toLowerCase()),h.supported=h.chrome||h.ff||h.opera,h.ie&&console.warn("IE is not supported...")}catch(a){console.error("Error initializing favico...",
a,u)}})();return{badge:function(a,b){m=function(){try{0<a?(g.types[""+b]&&(c.animation=b),n.push({type:"badge",options:{n:a}}),100<n.length&&console.warn("Too many badges request in queue..."),q.start()):q.reset()}catch(d){console.error("Error setting badge...",d)}};s&&m()},video:function(a){m=function(){try{"stop"===a?(t=!0,q.reset(),t=!1):a.addEventListener("play",function(){y(this)},!1)}catch(b){throw console.error("Error setting video...",b),b;}};s&&m()},image:function(a){m=function(){try{var c=
a.width,g=a.height,e=document.createElement("img"),h=c/d<g/f?c/d:g/f;e.setAttribute("src",a.getAttribute("src"));e.height=g/h;e.width=c/h;b.clearRect(0,0,d,f);b.drawImage(e,0,0,d,f);v.setIcon(p)}catch(k){throw console.error("Error setting image...",k),k;}};s&&m()},webcam:function(a){window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(a){return a});if(h.supported){var b=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||
navigator.mozGetUserMedia||navigator.webkitGetUserMedia;m=function(){try{"stop"===a?(t=!0,q.reset(),t=!1):(b=document.createElement("video"),b.width=d,b.height=f,navigator.getUserMedia({video:!0,audio:!1},function(a){b.src=URL.createObjectURL(a);b.play();y(b)},function(){}))}catch(c){throw console.error("Error setting webcam...",c),c;}};s&&m()}else console.log("Sorry. Only chrome and firefox  is supported yet...")},reset:q.reset}};